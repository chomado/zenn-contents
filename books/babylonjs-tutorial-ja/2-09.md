---
title: "2-09: ãƒ¡ãƒƒã‚·ãƒ¥ã‚’ã‚³ãƒ”ãƒ¼ (Copying Meshes)"
---

ã“ã®ãƒšãƒ¼ã‚¸ã®åŸæ–‡ï¼š https://doc.babylonjs.com/start/chap2/copies

# ğŸ˜ğŸ˜ 2-09: ãƒ¡ãƒƒã‚·ãƒ¥ã‚’ã‚³ãƒ”ãƒ¼ (Copying Meshes)


## ãƒ¡ãƒƒã‚·ãƒ¥ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹

ãƒ¡ãƒƒã‚·ãƒ¥ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã«ã¯ã€ä¸»ãªæ–¹æ³•ãŒ 2 ã¤ã‚ã‚Šã¾ã™ï¼š(ãã®ãƒ¡ãƒƒã‚·ãƒ¥ã‚’) ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ã‹ ãã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ã‹ã§ã™ã€‚
ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä½œæˆã™ã‚‹ã¨ã€ãƒ¡ãƒƒã‚·ãƒ¥ã®ç‹¬ç«‹ã—ãŸã‚³ãƒ”ãƒ¼ã‚’å¾—ã‚‰ã‚Œã¾ã™ãŒã€ä¸€æ–¹ã§ã€ãã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒãƒ†ãƒªã‚¢ãƒ«ã®ãƒªãƒ³ã‚¯ã‚’æŒã£ãŸã¾ã¾ã§ã™ã€‚åŸºæœ¬çš„ã«ã€ãƒ¡ãƒƒã‚·ãƒ¥ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒãƒ†ãƒªã‚¢ãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

å®¶ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ã«ã¯ã“ã†ã—ã¾ã™ï¼š

```js
clonedHouse = house.clone("clonedHouse")
```

ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ã“ã†ãªã‚Šã¾ã™

```js
instanceHouse = house.createInstance("instanceHouse")
```

ã“ã®æ™‚ç‚¹ã§ã€ç§ãŸã¡ã®ä¸–ç•Œï¼ˆã„ã¾æ‘ã‚’ä½œã£ã¦ã„ã‚‹ã®ã§ã—ãŸã­ï¼‰ã®å…¨ã¦ã®å®¶ã¯ `createInstance` ã§ä½¿ç”¨ã™ã‚‹ã®ã¨åŒã˜ãƒãƒ†ãƒªã‚¢ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

# ğŸ”¨ğŸ˜ å®¶ã‚’ä½œã‚‹é–¢æ•°

å®¶ï¼ˆå¹… 1, 2 ã®å®¶ï¼‰ã‚’è¤‡æ•°å€‹ ä½œã‚‹é–¢æ•°ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚
[â†’ Playgroundã§ãƒ©ã‚¤ãƒ–ãƒ‡ãƒ¢ã¨ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª](https://playground.babylonjs.com/#KBS9I5#77)

```js
const createScene =  () => {
    const scene = new BABYLON.Scene(engine);
    const camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 2.5, 10, new BABYLON.Vector3(0, 0, 0));
    camera.attachControl(canvas, true);
    const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0));
    
    const ground = buildGround();
    const house = buildHouse(2); // é–¢æ•°å‘¼ã³å‡ºã—å…ƒ
    
    return scene;
}

/** ã“ã“ã‹ã‚‰ï¼å®¶ã‚’ä½œã‚‹é–¢æ•° **/
const buildGround = () => {
    //color
    const groundMat = new BABYLON.StandardMaterial("groundMat");
    groundMat.diffuseColor = new BABYLON.Color3(0, 1, 0);

    const ground = BABYLON.MeshBuilder.CreateGround("ground", {width:10, height:10});
    ground.material = groundMat;
}

// å¹… width ã‚’å¼•æ•°ã§å—ã‘ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹
const buildHouse = (width) => {
    const box = buildBox(width);
    const roof = buildRoof(width);

    return BABYLON.Mesh.MergeMeshes([box, roof], true, false, null, false, true);
}
const buildBox = (width) => {
    //texture
    const boxMat = new BABYLON.StandardMaterial("boxMat");
    if (width == 2) {
       boxMat.diffuseTexture = new BABYLON.Texture("https://assets.babylonjs.com/environments/semihouse.png") 
    }
    else {
        boxMat.diffuseTexture = new BABYLON.Texture("https://assets.babylonjs.com/environments/cubehouse.png");   
    }

    const faceUV = [];
    if (width == 2) {
        faceUV[0] = new BABYLON.Vector4(0.6, 0.0, 1.0, 1.0); //rear face
        faceUV[1] = new BABYLON.Vector4(0.0, 0.0, 0.4, 1.0); //front face
        faceUV[2] = new BABYLON.Vector4(0.4, 0, 0.6, 1.0); //right side
        faceUV[3] = new BABYLON.Vector4(0.4, 0, 0.6, 1.0); //left side
    }
    else {
        faceUV[0] = new BABYLON.Vector4(0.5, 0.0, 0.75, 1.0); //rear face
        faceUV[1] = new BABYLON.Vector4(0.0, 0.0, 0.25, 1.0); //front face
        faceUV[2] = new BABYLON.Vector4(0.25, 0, 0.5, 1.0); //right side
        faceUV[3] = new BABYLON.Vector4(0.75, 0, 1.0, 1.0); //left side
    }

    /**** World Objects *****/
    const box = BABYLON.MeshBuilder.CreateBox("box", {width: width, faceUV: faceUV, wrap: true});
    box.material = boxMat;
    box.position.y = 0.5;

    return box;
}

const buildRoof = (width) => {
    //texture
    const roofMat = new BABYLON.StandardMaterial("roofMat");
    roofMat.diffuseTexture = new BABYLON.Texture("https://assets.babylonjs.com/environments/roof.jpg");

    const roof = BABYLON.MeshBuilder.CreateCylinder("roof", {diameter: 1.3, height: 1.2, tessellation: 3});
    roof.material = roofMat;
    roof.scaling.x = 0.75;
    roof.scaling.y = width;
    roof.rotation.z = Math.PI / 2;
    roof.position.y = 1.22;

    return roof;
}
```

# ğŸ˜ğŸ˜ å®¶ã‚’è¤‡è£½ã—ã¦é…ç½®ã™ã‚‹

![](https://doc.babylonjs.com/_next/image?url=%2Fimg%2Fgetstarted%2Fvillage1.png&w=2048&q=75)

ã“ã“ã§ã€åœ°é¢ã‚’æ‹¡å¤§ã—ã€ã‚«ãƒ¡ãƒ©ã®åŠå¾„ã‚’å°‘ã—å¤§ããã—ã€å®¶ãŒã‚ˆãè¦‹ãˆã‚‹ã‚ˆã†è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚
ã¾ãšã€å„ã‚¿ã‚¤ãƒ—ã®å®¶ã‚’ 1 ã¤ãšã¤å»ºã¦ã¦ã€é…ç½®ã—ã¾ã™ã€‚
ãã—ã¦ãã‚Œã‚‰ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€ãã‚Œãã‚Œã®å‘ãã‚„ä½ç½®ã‚’æ±ºã‚ãŸã‚‰ã€ãƒ«ãƒ¼ãƒ—ã•ã›ã¦ç½®ã„ã¦ã„ãã¾ã™ã€‚



[â†’ Playgroundã§ãƒ©ã‚¤ãƒ–ãƒ‡ãƒ¢ã¨ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª](https://playground.babylonjs.com/#KBS9I5#78)

```js
const detached_house = buildHouse(1);
detached_house.rotation.y = -Math.PI / 16;
detached_house.position.x = -6.8;
detached_house.position.z = 2.5;

const semi_house = buildHouse(2);
semi_house .rotation.y = -Math.PI / 16;
semi_house.position.x = -4.5;
semi_house.position.z = 3;

// é…ç½®
const places = []; // é…åˆ— [å®¶ã®ã‚¿ã‚¤ãƒ—, å‘ã, x, z]
places.push([1, -Math.PI / 16, -6.8, 2.5 ]);
places.push([2, -Math.PI / 16, -4.5, 3 ]);
places.push([2, -Math.PI / 16, -1.5, 4 ]);
places.push([2, -Math.PI / 3, 1.5, 6 ]);
places.push([2, 15 * Math.PI / 16, -6.4, -1.5 ]);
places.push([1, 15 * Math.PI / 16, -4.1, -1 ]);
places.push([2, 15 * Math.PI / 16, -2.1, -0.5 ]);
places.push([1, 5 * Math.PI / 4, 0, -1 ]);
places.push([1, Math.PI + Math.PI / 2.5, 0.5, -3 ]);
places.push([2, Math.PI + Math.PI / 2.1, 0.75, -5 ]);
places.push([1, Math.PI + Math.PI / 2.25, 0.75, -7 ]);
places.push([2, Math.PI / 1.9, 4.75, -1 ]);
places.push([1, Math.PI / 1.95, 4.5, -3 ]);
places.push([2, Math.PI / 1.9, 4.75, -5 ]);
places.push([1, Math.PI / 1.9, 4.75, -7 ]);
places.push([2, -Math.PI / 3, 5.25, 2 ]);
places.push([1, -Math.PI / 3, 6, 4 ]);

// å®¶ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã£ã¦ã„ã£ã¦é…åˆ—ã«çªã£è¾¼ã‚“ã§ã‚‹
const houses = [];
for (let i = 0; i < places.length; i++) {
    if (places[i][0] === 1) {
        houses[i] = detached_house.createInstance("house" + i);
    }
    else {
        houses[i] = semi_house.createInstance("house" + i);
    }
    houses[i].rotation.y = places[i][1];
    houses[i].position.x = places[i][2];
    houses[i].position.z = places[i][3];
}
```

## ã‚³ãƒ¼ãƒ‰ã®é–¢æ•°åŒ–

ä»¥å‰ã¨åŒæ§˜ã«ã€ã“ã‚Œã‚‰ã®å®¶ã®å»ºã¦ã‚‹å‡¦ç†ã‚’é–¢æ•°åŒ–ã—ã¾ã—ã‚‡ã†ã€‚ï¼ˆè»½ã„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰

@[codepen](https://codepen.io/chomado/pen/OJzpvyR)

â†‘ JS ã‚¿ãƒ–ã§ã‚³ãƒ¼ãƒ‰è¦‹ã‚Œã¾ã™ã€‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚ã‚¯ãƒªãƒƒã‚¯ã§ã‚°ãƒªã‚°ãƒªå‹•ã‹ã›ã¾ã™

```js
function createScene() {
    const scene = new BABYLON.Scene(engine);

    /**** Set camera and light *****/
    const camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 2.5, 15, new BABYLON.Vector3(0, 0, 0));
    camera.attachControl(canvas, true);
    const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0));
    
    buildDwellings(); // é–¢æ•°å‘¼ã³å‡ºã—
    return scene;
  }
  
  /******Build Functions***********/
  const buildDwellings = () => {
      const ground = buildGround();

      const detached_house = buildHouse(1);
      detached_house.rotation.y = -Math.PI / 16;
      detached_house.position.x = -6.8;
      detached_house.position.z = 2.5;

      const semi_house = buildHouse(2);
      semi_house .rotation.y = -Math.PI / 16;
      semi_house.position.x = -4.5;
      semi_house.position.z = 3;

      const places = []; //each entry is an array [house type, rotation, x, z]
      places.push([1, -Math.PI / 16, -6.8, 2.5 ]);
      places.push([2, -Math.PI / 16, -4.5, 3 ]);
      places.push([2, -Math.PI / 16, -1.5, 4 ]);
      places.push([2, -Math.PI / 3, 1.5, 6 ]);
      places.push([2, 15 * Math.PI / 16, -6.4, -1.5 ]);
      places.push([1, 15 * Math.PI / 16, -4.1, -1 ]);
      places.push([2, 15 * Math.PI / 16, -2.1, -0.5 ]);
      places.push([1, 5 * Math.PI / 4, 0, -1 ]);
      places.push([1, Math.PI + Math.PI / 2.5, 0.5, -3 ]);
      places.push([2, Math.PI + Math.PI / 2.1, 0.75, -5 ]);
      places.push([1, Math.PI + Math.PI / 2.25, 0.75, -7 ]);
      places.push([2, Math.PI / 1.9, 4.75, -1 ]);
      places.push([1, Math.PI / 1.95, 4.5, -3 ]);
      places.push([2, Math.PI / 1.9, 4.75, -5 ]);
      places.push([1, Math.PI / 1.9, 4.75, -7 ]);
      places.push([2, -Math.PI / 3, 5.25, 2 ]);
      places.push([1, -Math.PI / 3, 6, 4 ]);

      //Create instances from the first two that were built 
      const houses = [];
      for (let i = 0; i < places.length; i++) {
          if (places[i][0] === 1) {
              houses[i] = detached_house.createInstance("house" + i);
          }
          else {
              houses[i] = semi_house.createInstance("house" + i);
          }
          houses[i].rotation.y = places[i][1];
          houses[i].position.x = places[i][2];
          houses[i].position.z = places[i][3];
      }
  }

  const buildGround = () => {
      //color
      const groundMat = new BABYLON.StandardMaterial("groundMat");
      groundMat.diffuseColor = new BABYLON.Color3(0, 1, 0);

      const ground = BABYLON.MeshBuilder.CreateGround("ground", {width:15, height:16});
      ground.material = groundMat;
  }

  const buildHouse = (width) => {
      const box = buildBox(width);
      const roof = buildRoof(width);

      return BABYLON.Mesh.MergeMeshes([box, roof], true, false, null, false, true);
  }

  const buildBox = (width) => {
      //texture
      const boxMat = new BABYLON.StandardMaterial("boxMat");
      if (width == 2) {
         boxMat.diffuseTexture = new BABYLON.Texture("https://assets.babylonjs.com/environments/semihouse.png") 
      }
      else {
          boxMat.diffuseTexture = new BABYLON.Texture("https://assets.babylonjs.com/environments/cubehouse.png");   
      }

      // ãã‚Œãã‚Œã®é¢ã«é•ã£ãŸç”»åƒã‚’ã‚ã¦ã‚‹ãŸã‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
      const faceUV = [];
      if (width == 2) {
          faceUV[0] = new BABYLON.Vector4(0.6, 0.0, 1.0, 1.0); //rear face
          faceUV[1] = new BABYLON.Vector4(0.0, 0.0, 0.4, 1.0); //front face
          faceUV[2] = new BABYLON.Vector4(0.4, 0, 0.6, 1.0); //right side
          faceUV[3] = new BABYLON.Vector4(0.4, 0, 0.6, 1.0); //left side
      }
      else {
          faceUV[0] = new BABYLON.Vector4(0.5, 0.0, 0.75, 1.0); //rear face
          faceUV[1] = new BABYLON.Vector4(0.0, 0.0, 0.25, 1.0); //front face
          faceUV[2] = new BABYLON.Vector4(0.25, 0, 0.5, 1.0); //right side
          faceUV[3] = new BABYLON.Vector4(0.75, 0, 1.0, 1.0); //left side
      }

      const box = BABYLON.MeshBuilder.CreateBox("box", {width: width, faceUV: faceUV, wrap: true});
      box.material = boxMat;
      box.position.y = 0.5;

      return box;
  }

  const buildRoof = (width) => {
      // ãƒ†ã‚¯ã‚¹ãƒãƒ£
      const roofMat = new BABYLON.StandardMaterial("roofMat");
      roofMat.diffuseTexture = new BABYLON.Texture("https://assets.babylonjs.com/environments/roof.jpg");

      const roof = BABYLON.MeshBuilder.CreateCylinder("roof", {diameter: 1.3, height: 1.2, tessellation: 3});
      roof.material = roofMat;
      roof.scaling.x = 0.75;
      roof.scaling.y = width;
      roof.rotation.z = Math.PI / 2;
      roof.position.y = 1.22;

      return roof;
  }
  const scene = createScene();
  ```

## .glb å½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

ã“ã®ä½œã£ãŸæ‘ãƒ¢ãƒ‡ãƒ«ã‚’ web ãƒšãƒ¼ã‚¸ã«åŸ‹ã‚è¾¼ã‚€ãŸã‚ã«ã€`.glb` ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ã‚‡ã†ã€‚ï¼ˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã¯ Babylon.js Playground ã§ã§ãã¾ã™ã€‚ã‚„ã‚Šæ–¹ã¯ 1-01 ã®ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ï¼‰

![](https://storage.googleapis.com/zenn-user-upload/0a22de63d132-20220327.png)


ã“ã‚Œã‚’ web ãƒšãƒ¼ã‚¸ã§è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã¯ `1-02` ã‹ã‚‰ `1-04` ã§ã”ç´¹ä»‹ã—ãŸé€šã‚Šã§ã™ã€‚

ã¡ãªã¿ã« `createScene` é–¢æ•°ã¯ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```js
const createScene = () => {
    const scene = new BABYLON.Scene(engine);
    const camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 2.5, 15, new BABYLON.Vector3(0, 0, 0));
    camera.attachControl(canvas, true);
    const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0)); 
    // ã“ã“ã§ .glb èª­ã¿è¾¼ã¿
    BABYLON.SceneLoader.ImportMeshAsync("", "https://assets.babylonjs.com/meshes/", "village.glb");
    return scene;
};
```

